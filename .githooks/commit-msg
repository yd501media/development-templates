#!/bin/sh
set -eu

message_file="$1"
subject="$(head -n 1 "$message_file" | tr -d '\r')"

# Allow merge/revert commits generated by git.
case "$subject" in
  Merge\ *|Revert\ * )
    exit 0
    ;;
esac

pattern='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-zA-Z0-9._-]+\))?(!)?: .+'
if ! printf '%s' "$subject" | grep -E -q "$pattern"; then
  echo "Error: commit message must follow Conventional Commits (e.g., 'feat: add x')." >&2
  exit 1
fi
